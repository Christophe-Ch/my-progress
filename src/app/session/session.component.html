<form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
  <div class="left-column">
    <div>
      <h1>New session</h1>
      <div class="session-info">
        <mat-form-field>
          <mat-label>Title</mat-label>
          <input
            matInput
            placeholder="Chest day"
            formControlName="title"
            autocomplete="off"
            data-form-type="other"
          />
          @if (formGroup.controls['title'].hasError('required')) {
          <mat-error>Title is <strong>required</strong></mat-error>
          }
        </mat-form-field>

        <mat-form-field>
          <mat-label>Session date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date" />
          <mat-hint>MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle
            matIconSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>

    <button
      mat-flat-button
      color="primary"
      type="submit"
      [disabled]="formGroup.invalid"
    >
      <mat-icon>save</mat-icon> Save session
    </button>
  </div>

  <div class="right-column">
    <h2>Exercises</h2>
    <ng-container formArrayName="exercises">
      @for (exercise of exercises; track $index) {
      <mat-card [formGroup]="exercise" class="exercise card">
        <mat-card-content>
          <mat-form-field class="exercise-input">
            <mat-label>Exercise</mat-label>
            <input
              matInput
              placeholder="Bench press"
              formControlName="exercise"
              autocomplete="off"
              data-form-type="other"
            />
          </mat-form-field>
          <mat-divider></mat-divider>
          <span class="sets-heading">Sets</span>
          @for (set of sets(exercise); track $index) {
          <div class="set" [formGroup]="set">
            <div class="set-form">
              <mat-form-field>
                <mat-label>Repetitions</mat-label>
                <input
                  matInput
                  type="number"
                  formControlName="repetitions"
                  autocomplete="off"
                  data-form-type="other"
                />
              </mat-form-field>
              <mat-form-field>
                <mat-label>Weight</mat-label>
                <input
                  matInput
                  type="number"
                  formControlName="weight"
                  autocomplete="off"
                  data-form-type="other"
                />
              </mat-form-field>
            </div>
            <div class="set-actions">
              <button
                mat-icon-button
                color="warn"
                type="button"
                (click)="removeSet(exercise, $index)"
              >
                <mat-icon>delete</mat-icon>
              </button>
              <button
                mat-icon-button
                color="primary"
                type="button"
                (click)="duplicateSet(exercise, $index)"
              >
                <mat-icon>content_copy</mat-icon>
              </button>
              <button
                mat-icon-button
                color="primary"
                type="button"
                (click)="addSet(exercise, $index)"
              >
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>
          }
          <mat-divider></mat-divider>
        </mat-card-content>
        <mat-card-actions align="end">
          <button
            mat-button
            color="warn"
            type="button"
            (click)="removeExercise($index)"
          >
            <mat-icon>delete</mat-icon> Remove
          </button>
        </mat-card-actions>
      </mat-card>
      }
      <button mat-fab color="primary" (click)="addExercise()" type="button">
        <mat-icon>add</mat-icon>
      </button>
    </ng-container>
  </div>
</form>
